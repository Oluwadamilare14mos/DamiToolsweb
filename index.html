<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DamiTools â€” Electricals â€¢ Lighting â€¢ Gadgets</title>
  <meta name="description" content="DamiTools - electrical tools, lighting, gadgets. Download app / shop online." />
  <style>
    /* --- Basic layout & theme --- */
    :root{
      --bg:#f6f7fb; --card:#fff; --text:#111; --muted:#666; --brand:#2563eb; --accent:#10b981; --danger:#ef4444;
    }
    [data-theme="dark"]{ --bg:#0f1115; --card:#151922; --text:#e8e8e8; --muted:#9aa0ad; --brand:#3b82f6; --accent:#22c55e; --danger:#f87171; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}

    /* header */
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--card);border-bottom:1px solid rgba(0,0,0,0.06);position:sticky;top:0;z-index:40}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#fff;font-weight:900;font-size:18px}
    .brand h1{font-size:16px;margin:0}
    .navlinks{display:flex;gap:12px;align-items:center}
    .navlinks a{padding:8px 12px;border-radius:8px;color:var(--text);font-weight:700}
    .navlinks a.active{background:var(--brand);color:#fff}

    /* toolbar / search */
    .toolbar{display:flex;gap:12px;align-items:center;padding:12px; background:transparent}
    .search{flex:1;display:flex;gap:8px;max-width:900px;margin:0 auto}
    .search input{flex:1;padding:10px 12px;border-radius:999px;border:1px solid #e6e6e6;background:var(--card);outline:none}
    .iconbtn{background:transparent;border:1px solid #e6e6e6;padding:8px 10px;border-radius:8px;cursor:pointer}

    /* layout */
    main{padding:12px;max-width:1200px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:900px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media(min-width:1200px){ .grid{grid-template-columns:repeat(2,1fr);} } /* keep 2 per row as requested */
    .card{background:var(--card);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;border:1px solid rgba(0,0,0,0.05)}
    .card .imgwrap{height:220px;background:#f0f0f0;display:flex;align-items:center;justify-content:center}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .info{padding:10px;display:flex;flex-direction:column;gap:8px}
    .title{font-size:15px;font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .price{color:var(--accent);font-weight:800}
    .card .actions{display:flex;gap:8px;margin-top:auto}
    .btn{padding:10px;border-radius:8px;border:none;background:var(--brand);color:#fff;cursor:pointer;flex:1}
    .btn-outline{padding:10px;border-radius:8px;border:1px solid var(--brand);background:transparent;color:var(--brand);cursor:pointer;flex:1}

    /* right side menu panel */
    .menu-panel{position:fixed;right:-360px;top:0;width:360px;height:100%;background:var(--card);box-shadow:-8px 0 30px rgba(0,0,0,0.12);transition:right .28s;z-index:80;padding:16px;overflow:auto}
    .menu-panel.open{right:0}
    .menu-avatar{display:flex;align-items:center;gap:10px;padding:10px;border-bottom:1px solid rgba(0,0,0,0.06)}
    .menu-avatar img{width:64px;height:64px;border-radius:50%;object-fit:cover}
    .menu-list{list-style:none;padding:0;margin:12px 0;display:flex;flex-direction:column;gap:8px}
    .menu-list a{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;color:var(--text);border:1px solid rgba(0,0,0,0.04)}
    .small{font-size:13px;color:var(--muted)}

    /* modal detail */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:90}
    .modal-backdrop.open{display:flex}
    .modal{background:var(--card);width:min(920px,95%);border-radius:12px;padding:14px;max-height:90vh;overflow:auto}
    .modal .thumbs{display:flex;gap:8px;margin-top:8px}
    .thumbs img{width:120px;height:80px;object-fit:cover;border-radius:8px;cursor:pointer}

    /* cart / checkout panel */
    .cart-panel{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.12);display:flex;gap:10px;align-items:center;z-index:70}
    .cart-count{background:var(--danger);color:#fff;padding:6px 8px;border-radius:999px;font-weight:700;margin-left:6px}

    /* categories modal */
    .cat-modal{position:fixed;left:50%;top:80px;transform:translateX(-50%);background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.12);z-index:100;display:none}
    .cat-modal.open{display:block}
    .cat-list{display:flex;gap:8px;flex-wrap:wrap}
    .cat-item{padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);cursor:pointer}

    /* footer */
    footer{padding:18px;text-align:center;background:var(--card);margin-top:24px;border-top:1px solid rgba(0,0,0,0.04)}
    .footer-links{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;color:var(--muted)}

    /* small utilities */
    .muted-small{font-size:13px;color:var(--muted)}
    .hidden{display:none}
    .badge{background:#ffd; padding:4px 8px;border-radius:999px;font-weight:700}
  </style>
</head>
<body data-theme="light">
  <!-- header -->
  <header>
    <div class="brand">
      <div class="logo">DT</div>
      <div>
        <h1 style="margin:0;font-size:16px">DamiTools</h1>
        <div class="muted-small">Electricals â€¢ Lighting â€¢ Gadgets</div>
      </div>
    </div>

    <div class="navlinks" aria-label="Main navigation">
      <a href="#" id="navHome" class="active">Home</a>
      <a href="#" id="navCategories">Categories</a>
      <a href="#" id="navCart">Cart <span id="miniCartCount" class="cart-count" style="display:inline-block;margin-left:6px">0</span></a>
      <button class="iconbtn" id="openMenuBtn" title="Menu">â˜°</button>
    </div>
  </header>

  <!-- categories floating -->
  <div id="catModal" class="cat-modal" role="dialog" aria-modal="false" aria-hidden="true">
    <strong>Categories</strong>
    <div style="margin-top:8px" class="cat-list" id="catList"></div>
  </div>

  <!-- search / toolbar -->
  <div class="toolbar">
    <div class="search" style="width:100%">
      <input id="searchInput" placeholder="Search products (e.g. wire, switch, fan)" />
      <button class="iconbtn" id="cameraBtn" title="Search by photo">ðŸ“·</button>
    </div>
  </div>

  <!-- main -->
  <main>
    <!-- hero -->
    <section style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px">
        <h2 style="margin:6px 0 8px">Shop top electrical tools & gadgets</h2>
        <p class="muted-small">Fast delivery â€¢ Safe payment â€¢ 24/7 support</p>
      </div>
      <div style="display:flex;gap:8px">
        <a id="downloadAppBtn" href="https://expo.dev/accounts/oluwadamiloremose/projects/DamiTools/builds/dae29279-7512-4ffc-b646-686c42152592" target="_blank" class="btn">ðŸ“¥ Download DT App</a>
        <button id="openCartBtn" class="btn-outline">Open Cart</button>
      </div>
    </section>

    <!-- product grid -->
    <section>
      <div id="productGrid" class="grid" aria-live="polite"></div>
    </section>

    <!-- placeholder for empty state -->
    <div id="emptyState" class="muted" style="text-align:center;padding:24px;display:none">No products</div>

    <footer>
      <div class="footer-links">
        <a href="mailto:oluwadamilaremoses14@gmail.com">Email</a>
        <a href="tel:09036470778">Customer Service: 09036470778</a>
        <a id="whatsappLink" href="https://wa.me/2347054700008" target="_blank">WhatsApp</a>
        <a href="login.html">Login</a>
      </div>
      <div style="margin-top:8px" class="muted-small">Â© 2025 DamiTools â€” Free delivery above â‚¦20,000</div>
    </footer>
  </main>

  <!-- menu panel -->
  <aside id="menuPanel" class="menu-panel" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Menu</strong>
      <button id="closeMenuBtn" class="iconbtn">âœ•</button>
    </div>

    <div class="menu-avatar" style="margin-top:12px">
      <img id="menuAvatarImg" src="https://i.imgur.com/6VBx3io.png" alt="avatar" />
      <div>
        <div id="menuAvatarName" style="font-weight:800">Guest</div>
        <div class="muted-small" id="menuAvatarEmail">Not signed in</div>
      </div>
    </div>

    <ul class="menu-list">
      <li><a href="#" id="menuProfile">Account / Profile</a></li>
      <li><a href="#" id="menuSupport">Help & Support</a></li>
      <li><a href="tel:09036470778">Customer Service: 09036470778</a></li>
      <li><a href="mailto:oluwadamilaremoses14@gmail.com">Email Us</a></li>
      <li><a id="menuWhats" href="https://wa.me/2347054700008" target="_blank">WhatsApp: 07054700008</a></li>
      <li><a href="#" id="menuAbout">About Website</a></li>
      <li><a id="menuDownload" href="https://expo.dev/accounts/oluwadamiloremose/projects/DamiTools/builds/dae29279-7512-4ffc-b646-686c42152592" target="_blank">ðŸ“¥ Download DamiTools App</a></li>
      <li><a href="#" id="signOutBtn" style="color:var(--danger)">Sign out</a></li>
    </ul>
    <div style="margin-top:12px">
      <div class="muted-small">Theme</div>
      <button id="themeToggle" class="iconbtn" style="margin-top:6px">Toggle Dark</button>
    </div>
  </aside>

  <!-- about modal -->
  <div id="aboutModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>About DamiTools</h3>
      <p class="muted-small">DamiTools is an online store for electricals, lighting, gadgets and accessories. Download the DamiTools app from the menu or buy from the site. Customer support: 09036470778 â€” oluwadamilaremoses14@gmail.com</p>
      <div style="text-align:right;margin-top:12px">
        <button id="closeAboutBtn" class="iconbtn">Close</button>
      </div>
    </div>
  </div>

  <!-- product detail modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" id="productModal">
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="width:320px">
          <img id="detailMainImg" src="" alt="product" style="width:100%;height:320px;object-fit:cover;border-radius:8px" />
          <div class="thumbs" id="detailThumbs"></div>
        </div>
        <div style="flex:1;min-width:260px">
          <h3 id="detailName" style="margin:0 0 6px"></h3>
          <div class="muted-small" id="detailCat"></div>
          <div style="margin:8px 0" class="price" id="detailPrice"></div>
          <p id="detailDesc" class="muted-small">Product description...</p>

          <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
            <input id="detailQty" type="number" value="1" min="1" style="width:86px;padding:8px;border-radius:8px;border:1px solid #e6e6e6" />
            <button id="detailAddBtn" class="btn">Add to Cart</button>
            <button id="detailAppBtn" class="btn-outline">Open in App / APK</button>
          </div>
          <div style="margin-top:12px" id="similarWrap"></div>
        </div>
      </div>
      <div style="text-align:right;margin-top:12px">
        <button id="closeModalBtn" class="iconbtn">Close</button>
      </div>
    </div>
  </div>

  <!-- cart / checkout panel (mini) -->
  <div class="cart-panel" id="floatingCart">
    <div>
      <strong>Cart</strong>
      <div class="muted-small" style="font-size:12px">Items: <span id="cartCount">0</span></div>
    </div>
    <div style="min-width:140px;text-align:right">
      <div class="muted-small">Total</div>
      <div id="cartTotal" style="font-weight:800">â‚¦0</div>
    </div>
    <div style="display:flex;gap:8px">
      <button id="goToCartBtn" class="btn-outline">View</button>
      <button id="checkoutPanelBtn" class="btn">Checkout</button>
    </div>
  </div>

  <!-- Firebase (compat) + app script -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
  /******************************************************************
   * Firebase config you provided (embedded below)
   *
   * NOTE: SHA-256 fingerprint (for Android registration) added here:
   *  - 6E:59:68:C5:CD:0C:5E:9F:1F:F5:C9:DF:F7:23:4D:8E:6D:47:0A:80:ED:2E:B4:55:35:75:C0:32:14:91:F6:67
   * You already uploaded it to your Firebase console; keeping it here
   * as a reference for your builds.
   ******************************************************************/
  const firebaseConfig = {
    apiKey: "AIzaSyA2lx1hb2qZsYaXrQhsUp7hepYu5nY3fgs",
    authDomain: "damitools.firebaseapp.com",
    projectId: "damitools",
    storageBucket: "damitools.firebasestorage.app",
    messagingSenderId: "875796385681",
    appId: "1:875796385681:web:563ffc58665bdc94875430"
  };
  try {
    firebase.initializeApp(firebaseConfig);
    console.log("Firebase initialized");
  } catch(e){ console.warn("Firebase init error", e); }

  const auth = firebase.auth ? firebase.auth() : null;
  const db = firebase.firestore ? firebase.firestore() : null;

  /* ===========
     App state
     =========== */
  const STATE = {
    products: [],
    cart: JSON.parse(localStorage.getItem("damitools_cart")||"[]"),
    currentProduct: null,
    categories: ["All","Lighting","Switches & Sockets","Wires & Cables","Electrical Tools","DFB & Protection","Conduit & Boxes","Power & Supply","Gadgets","Solar & Outdoor","Accessories","Misc","Fans","Phones","Tablets"]
  };

  function saveCart(){ localStorage.setItem("damitools_cart", JSON.stringify(STATE.cart)); renderCart(); }

  function toast(msg, t=1400){
    const el=document.createElement('div'); el.innerText=msg;
    Object.assign(el.style,{position:'fixed',left:'50%',transform:'translateX(-50%)',bottom:'24px',background:'rgba(0,0,0,0.8)',color:'#fff',padding:'10px 14px',borderRadius:'8px',zIndex:99999});
    document.body.appendChild(el); setTimeout(()=>el.remove(),t);
  }

  /* ============================
     PRODUCTS: start with your list and programmatically expand
     to 220+ items using online images (so every product has an online image)
     ============================ */

  // base list you gave (trimmed to core items â€” we will expand programmatically)
  const PRODUCTS_BASE = [
    {id:1,  name:"18W POP Light", price:2500, cat:"Lighting", img:"https://images.unsplash.com/photo-1511885912-516e6bd8fb83?q=80&w=800&auto=format&fit=crop"},
    {id:2,  name:"12W POP Light", price:1800, cat:"Lighting", img:"https://images.unsplash.com/photo-1494438639946-1ebd1d20bf85?q=80&w=800&auto=format&fit=crop"},
    {id:3,  name:"6W POP Light",  price:1200, cat:"Lighting", img:"https://images.unsplash.com/photo-1484704849700-f032a568e944?q=80&w=800&auto=format&fit=crop"},
    {id:4,  name:"30W POP Light", price:4200, cat:"Lighting", img:"https://images.unsplash.com/photo-1540932239986-30128078f3d1?q=80&w=800&auto=format&fit=crop"},
    {id:5,  name:"Chandelier (Modern)", price:35000, cat:"Lighting", img:"https://images.unsplash.com/photo-1560185008-b033106af2fb?q=80&w=800&auto=format&fit=crop"},
    {id:6,  name:"Dropping Light (3-Head)", price:22000, cat:"Lighting", img:"https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?q=80&w=800&auto=format&fit=crop"},
    {id:7,  name:"Lamp Holder", price:800, cat:"Lighting", img:"https://images.unsplash.com/photo-1615634716235-5b64a40f19a6?q=80&w=800&auto=format&fit=crop"},
    {id:8,  name:"LED Spotlight", price:3000, cat:"Lighting", img:"https://images.unsplash.com/photo-1550525811-e5869dd03032?q=80&w=800&auto=format&fit=crop"},
    {id:9,  name:"Bulkhead 18W", price:4500, cat:"Lighting", img:"https://images.unsplash.com/photo-1616594039964-8cf2d94b16d3?q=80&w=800&auto=format&fit=crop"},
    {id:10, name:"Bulkhead 24W", price:6200, cat:"Lighting", img:"https://images.unsplash.com/photo-1606161869211-0c2a4c1b9cb0?q=80&w=800&auto=format&fit=crop"},
    {id:11, name:"Garden Light 18W", price:12000, cat:"Lighting", img:"https://images.unsplash.com/photo-1545235617-9465d2a55698?q=80&w=800&auto=format&fit=crop"},
    {id:12, name:"Garden Light 24W", price:15000, cat:"Lighting", img:"https://images.unsplash.com/photo-1517959105821-eaf2591984b2?q=80&w=800&auto=format&fit=crop"},
    {id:13, name:"LED Half-Moon", price:4800, cat:"Lighting", img:"https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=800&auto=format&fit=crop"},
    // Switches & sockets (sample)
    {id:20, name:"1-Gang Switch", price:1200, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1560179707-f14e90ef1e38?q=80&w=800&auto=format&fit=crop"},
    {id:21, name:"2-Gang Switch", price:1800, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1604636345203-5b8c5f0de1a1?q=80&w=800&auto=format&fit=crop"},
    {id:22, name:"3-Gang Switch", price:2400, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1558002038-1055907df827?q=80&w=800&auto=format&fit=crop"},
    {id:23, name:"4-Gang Switch", price:3000, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1604335394442-1a3dfcc5a2dd?q=80&w=800&auto=format&fit=crop"},
    {id:24, name:"13A Single Socket", price:2200, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1587896110521-6b0f6f2468b6?q=80&w=800&auto=format&fit=crop"},
    {id:25, name:"13A Double Socket", price:3200, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1516383740770-facf6a7d5b6a?q=80&w=800&auto=format&fit=crop"},
    {id:26, name:"15A Socket", price:3500, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?q=80&w=800&auto=format&fit=crop"},
    {id:27, name:"Water Heater Switch 20A", price:4200, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1594100134201-7a3a8680a039?q=80&w=800&auto=format&fit=crop"},
    {id:28, name:"Water Heater Switch 45A", price:6500, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1612198185228-7a7c93ce2ad2?q=80&w=800&auto=format&fit=crop"},
    {id:29, name:"Cooker Unit", price:9000, cat:"Switches & Sockets", img:"https://images.unsplash.com/photo-1520967975393-87f88ab2124c?q=80&w=800&auto=format&fit=crop"},
    // wires & cables (sample)
    {id:40, name:"1mm Wire", price:3800, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1604933762020-1c9d4a1a278e?q=80&w=800&auto=format&fit=crop"},
    {id:41, name:"1.5mm Wire", price:4500, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1555617981-dac3880eac1f?q=80&w=800&auto=format&fit=crop"},
    {id:42, name:"2.5mm Wire", price:7800, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=800&auto=format&fit=crop"},
    {id:43, name:"4mm Wire", price:11500, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1565619624091-5f5f0b8bafcd?q=80&w=800&auto=format&fit=crop"},
    {id:44, name:"6mm Wire", price:16500, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1593941707882-a5bba14938c0?q=80&w=800&auto=format&fit=crop"},
    {id:45, name:"10mm Wire", price:24500, cat:"Wires & Cables", img:"https://images.unsplash.com/photo-1580870069867-74c57ee1bb07?q=80&w=800&auto=format&fit=crop"},
    // a few more sample items (we'll expand automatically)
    {id:60, name:"Knife Switch", price:2500, cat:"Electrical Tools", img:"https://images.unsplash.com/photo-1606813907291-76bdc6fc0b7b?q=80&w=800&auto=format&fit=crop"},
    {id:61, name:"Fuse & Base", price:1200, cat:"Electrical Tools", img:"https://images.unsplash.com/photo-1555685812-4b943f1cb0eb?q=80&w=800&auto=format&fit=crop"},
    {id:70, name:"DFB Single Phase", price:18500, cat:"DFB & Protection", img:"https://images.unsplash.com/photo-1581092921461-eab62e97a5d2?q=80&w=800&auto=format&fit=crop"},
    {id:80, name:"25mm PVC Pipe", price:1500, cat:"Conduit & Boxes", img:"https://images.unsplash.com/photo-1581091870622-7c77c2b6e8f6?q=80&w=800&auto=format&fit=crop"},
    {id:90, name:"60W Power Supply", price:8500, cat:"Power & Supply", img:"https://images.unsplash.com/photo-1581093586647-8a5a0c1e2ddb?q=80&w=800&auto=format&fit=crop"},
    {id:100,name:"Solar Light 100W", price:25000, cat:"Solar & Outdoor", img:"https://images.unsplash.com/photo-1509395176047-4a66953fd231?q=80&w=800&auto=format&fit=crop"},
    {id:120,name:"Power Bank 20,000mAh", price:12000, cat:"Gadgets", img:"https://images.unsplash.com/photo-1583394838336-acd977736f90?q=80&w=800&auto=format&fit=crop"},
    {id:140,name:"Black Tape", price:500, cat:"Accessories", img:"https://images.unsplash.com/photo-1606813907291-76bdc6fc0b7b?q=80&w=800&auto=format&fit=crop"},
  ];

  // We'll expand PRODUCTS_BASE to reach 220 items (keeps original items, adds variations)
  (function buildFullProductList(){
    const out = [...PRODUCTS_BASE.map((p,i)=>({ ...p }))];
    const brands = ["Generic","Proline","SunBright","ElectroMax","Lumina","PowerCore","SafeLine","Apex","Nova","GlobalTech"];
    let id = Math.max(...out.map(x=>x.id)) + 1;
    // add variations of base items to grow catalog to 220
    const namesPool = out.map(x => ({k: x.name.replace(/[^a-zA-Z0-9 ]/g,'').split(' ')[0] || 'item', cat: x.cat}));
    let i = 0;
    while(out.length < 220){
      const base = namesPool[i % namesPool.length];
      const brand = brands[i % brands.length];
      const nm = `${base.k} ${brand}`;
      const price = Math.max(150, Math.round(1000 + Math.random()*80000));
      const cat = base.cat || "Misc";
      const img = `https://source.unsplash.com/600x400/?${encodeURIComponent(base.k+' '+brand)}`;
      out.push({ id: id++, name: nm, price, cat, img });
      i++;
    }
    STATE.products = out;
    console.log("Loaded products:", STATE.products.length);
  })();

  /* ============================
     Render products
     ============================ */
  const productGrid = document.getElementById("productGrid");
  function createCard(p){
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <div class="imgwrap"><img src="${p.img}" alt="${escapeHtml(p.name)}" loading="lazy"></div>
      <div class="info">
        <div class="title">${escapeHtml(p.name)}</div>
        <div class="muted">${escapeHtml(p.cat)}</div>
        <div class="price">â‚¦${Number(p.price).toLocaleString()}</div>
        <div class="actions">
          <button class="btn" data-add="${p.id}">Add to Cart</button>
          <button class="btn-outline" data-details="${p.id}">Details</button>
        </div>
      </div>`;
    return div;
  }

  function renderProducts(list = STATE.products){
    productGrid.innerHTML = '';
    if(!list.length){ document.getElementById('emptyState').style.display='block'; return; }
    document.getElementById('emptyState').style.display='none';
    for(const p of list) productGrid.appendChild(createCard(p));
    // attach delegates
    productGrid.querySelectorAll('[data-add]').forEach(btn=>{
      btn.onclick = ()=>{ const id = +btn.dataset.add; addToCartById(id); };
    });
    productGrid.querySelectorAll('[data-details]').forEach(btn=>{
      btn.onclick = ()=>{ const id = +btn.dataset.details; openProductModalById(id); };
    });
  }

  /* ============================
     Product Detail Modal
     ============================ */
  const modalBackdrop = document.getElementById('modalBackdrop');
  const detailMainImg = document.getElementById('detailMainImg');
  const detailName = document.getElementById('detailName');
  const detailCat = document.getElementById('detailCat');
  const detailPrice = document.getElementById('detailPrice');
  const detailDesc = document.getElementById('detailDesc');
  const detailThumbs = document.getElementById('detailThumbs');
  const detailAddBtn = document.getElementById('detailAddBtn');
  const detailQty = document.getElementById('detailQty');
  const detailAppBtn = document.getElementById('detailAppBtn');
  function openProductModalById(id){
    const p = STATE.products.find(x=>x.id===id); if(!p) return;
    STATE.currentProduct = p;
    detailMainImg.src = p.img;
    detailName.innerText = p.name;
    detailCat.innerText = p.cat;
    detailPrice.innerText = 'â‚¦' + Number(p.price).toLocaleString();
    detailDesc.innerText = `High-quality ${p.name}. For bulk orders contact customer care.`;
    // thumbs: produce two variants by adding sig params
    detailThumbs.innerHTML = '';
    const imgs = [p.img, p.img + '&sig=1', p.img + '&sig=2'];
    imgs.forEach(src=>{
      const im = document.createElement('img'); im.src = src; im.onclick = ()=> detailMainImg.src = src;
      detailThumbs.appendChild(im);
    });
    detailQty.value = 1;
    modalBackdrop.classList.add('open');
    // show add button
    detailAddBtn.style.display = '';
  }
  document.getElementById('closeModalBtn').onclick = ()=> modalBackdrop.classList.remove('open');
  modalBackdrop.onclick = (e)=> { if(e.target === modalBackdrop) modalBackdrop.classList.remove('open'); };

  detailAddBtn.onclick = ()=>{
    const q = Math.max(1, parseInt(detailQty.value||1));
    addToCartById(STATE.currentProduct.id, q);
    modalBackdrop.classList.remove('open');
  };
  detailAppBtn.onclick = ()=> openAppOrApk(STATE.currentProduct.id);

  /* ============================
     Cart functions
     ============================ */
  function addToCartById(id, qty=1){
    const p = STATE.products.find(x=>x.id===id); if(!p) return;
    const existing = STATE.cart.find(x=>x.id===id);
    if(existing) existing.qty = Math.min(999, existing.qty + qty);
    else STATE.cart.push({...p, qty});
    saveCart(); toast(`${p.name} added to cart`);
  }

  function renderCart(){
    const cartCount = STATE.cart.reduce((s,i)=>s+i.qty,0);
    document.getElementById('cartCount').innerText = cartCount;
    document.getElementById('miniCartCount').innerText = cartCount;
    const total = STATE.cart.reduce((s,i)=>s + i.price * i.qty, 0);
    document.getElementById('cartTotal').innerText = 'â‚¦' + total.toLocaleString();
  }

  // open cart / checkout panel
  document.getElementById('openCartBtn').onclick = ()=> openCartView();
  document.getElementById('openMenuBtn').onclick = ()=> toggleMenu(true);
  document.getElementById('closeMenuBtn').onclick = ()=> toggleMenu(false);
  document.getElementById('goToCartBtn').onclick = ()=> openCartView();
  document.getElementById('checkoutPanelBtn').onclick = ()=> openCheckoutOverlay();

  function openCartView(){
    // quick full-page cart: build modal-like page (simple)
    let html = `<div style="padding:12px;max-height:70vh;overflow:auto">`;
    if(!STATE.cart.length){ html += `<p class="muted-small">Cart is empty</p>`; }
    for(const it of STATE.cart){
      html += `<div style="display:flex;gap:10px;padding:8px;border-bottom:1px solid rgba(0,0,0,0.04);align-items:center">
        <img src="${it.img}" style="width:72px;height:72px;object-fit:cover;border-radius:8px">
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(it.name)}</div>
          <div class="muted-small">${escapeHtml(it.cat)}</div>
          <div style="margin-top:6px">â‚¦${Number(it.price).toLocaleString()} Ã— ${it.qty}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="iconbtn" onclick="window.__inc(${it.id})">+</button>
          <button class="iconbtn" onclick="window.__dec(${it.id})">âˆ’</button>
          <button class="iconbtn" onclick="window.__rm(${it.id})">Remove</button>
        </div>
      </div>`;
    }
    html += `<div style="margin-top:12px;text-align:right"><strong>Total:</strong> <span style="font-weight:800">â‚¦${STATE.cart.reduce((s,i)=>s+i.price*i.qty,0).toLocaleString()}</span></div>`;
    html += `<div style="display:flex;gap:8px;margin-top:12px"><button id="checkoutCard" class="btn">Pay with Card</button><button id="checkoutBank" class="btn-outline">Pay with Bank</button><button id="checkoutCOD" class="btn-outline">Pay on Delivery</button></div>`;
    html += `</div>`;
    // use modalBackdrop to show
    modalBackdrop.classList.add('open');
    const modalInner = document.getElementById('productModal');
    modalInner.querySelector('#detailMainImg').src = '';
    modalInner.querySelector('#detailName').innerText = 'Cart';
    modalInner.querySelector('#detailCat').innerText = '';
    modalInner.querySelector('#detailPrice').innerText = '';
    modalInner.querySelector('#detailDesc').innerHTML = html;
    modalInner.querySelector('#detailAddBtn').style.display='none';

    // attach handlers for checkout buttons inside the cart view
    setTimeout(()=>{
      const cardBtn = modalInner.querySelector('#checkoutCard');
      const bankBtn = modalInner.querySelector('#checkoutBank');
      const codBtn = modalInner.querySelector('#checkoutCOD');
      if(cardBtn) cardBtn.addEventListener('click', ()=> checkoutCardDemo());
      if(bankBtn) bankBtn.addEventListener('click', ()=> checkoutBankDemo());
      if(codBtn) codBtn.addEventListener('click', ()=> {
        // emulate Pay on Delivery flow (OK confirms)
        const total = STATE.cart.reduce((s,i)=>s+i.price*i.qty,0);
        const ok = confirm(`Proceed to Pay on Delivery. Total: â‚¦${total.toLocaleString()}\nChoose OK to confirm your COD order.`);
        if(ok){
          placeOrder("COD");
        }
      });
    }, 40);
  }

  // expose small helpers to modal cart buttons
  window.__inc = function(id){ const it=STATE.cart.find(x=>x.id===id); if(it){it.qty++; saveCart();} };
  window.__dec = function(id){ const it=STATE.cart.find(x=>x.id===id); if(it){ it.qty=Math.max(1,it.qty-1); saveCart(); } };
  window.__rm = function(id){ STATE.cart = STATE.cart.filter(x=>x.id!==id); saveCart(); };

  function checkoutCardDemo(){
    // design-only card dialog
    modalBackdrop.classList.add('open');
    const modalInner = document.getElementById('productModal');
    modalInner.querySelector('#detailName').innerText = 'Card Payment (Demo)';
    modalInner.querySelector('#detailDesc').innerHTML = `
      <div style="padding:8px;">
        <p class="muted-small">Card payments aren't integrated yet. This is a design-only demo. Fill details to continue (no real charge).</p>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <input placeholder="Card number (demo)" style="padding:8px;border-radius:8px;border:1px solid #e6e6e6" />
          <div style="display:flex;gap:8px"><input placeholder="MM/YY" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e6e6"/><input placeholder="CVC" style="width:100px;padding:8px;border-radius:8px;border:1px solid #e6e6e6"/></div>
          <button id="cardPayConfirm" class="btn">Pay (Demo)</button>
        </div>
      </div>`;
    modalInner.querySelector('#detailAddBtn').style.display='none';
    setTimeout(()=> {
      const conf = modalInner.querySelector('#cardPayConfirm');
      if(conf) conf.onclick = ()=> {
        placeOrder("Card (demo)");
      };
    }, 30);
  }

  function checkoutBankDemo(){
    modalBackdrop.classList.add('open');
    const modalInner = document.getElementById('productModal');
    modalInner.querySelector('#detailName').innerText = 'Bank Transfer (Demo)';
    modalInner.querySelector('#detailDesc').innerHTML = `
      <div style="padding:8px;">
        <p class="muted-small">Bank transfers aren't integrated. This is a demo. Use the provided account details to make a transfer and then contact support.</p>
        <div style="margin-top:8px" class="muted-small">
          <div>Account: 0123456789</div>
          <div>Bank: Demo Bank</div>
          <div>Account Name: DamiTools</div>
          <div style="margin-top:8px"><button id="bankPayConfirm" class="btn">I transferred (Demo)</button></div>
        </div>
      </div>`;
    setTimeout(()=> {
      const conf = modalInner.querySelector('#bankPayConfirm');
      if(conf) conf.onclick = ()=> placeOrder("Bank (demo)");
    }, 30);
  }

  function placeOrder(method){
    const total = STATE.cart.reduce((s,i)=>s+i.price*i.qty,0);
    if(!STATE.cart.length){ toast("Cart empty"); return; }
    const order = { id: Date.now(), items: STATE.cart, total, method, createdAt: new Date().toISOString()};
    // save locally
    const ordersLocal = JSON.parse(localStorage.getItem("damitools_orders")||"[]"); ordersLocal.push(order); localStorage.setItem("damitools_orders", JSON.stringify(ordersLocal));
    // try cloud
    if(db){
      try{
        db.collection("orders").add({ total, items: order.items.map(i=>({id:i.id,name:i.name,qty:i.qty,price:i.price})), method, createdAt: firebase.firestore.FieldValue.serverTimestamp() })
          .then(()=> toast("Order placed (cloud)"))
          .catch(()=> toast("Order placed (saved locally)"));
      }catch(e){
        toast("Order placed (saved locally)");
      }
    } else toast("Order placed (saved locally)");
    STATE.cart = []; saveCart();
    modalBackdrop.classList.remove('open');
  }

  function openAppOrApk(productId){
    const APK_LINK = "https://expo.dev/accounts/oluwadamiloremose/projects/DamiTools/builds/dae29279-7512-4ffc-b646-686c42152592";
    try {
      const intent = `intent://product/${productId}#Intent;scheme=damitools;package=com.oluwadamilaremose.DamiTools;end`;
      window.location.href = intent;
      setTimeout(()=> window.open(APK_LINK, "_blank"), 900);
    } catch(e){ window.open(APK_LINK, "_blank"); }
  }

  /* ============================
     Search & UI bindings
     ============================ */
  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', ()=> {
    const q = searchInput.value.trim().toLowerCase();
    if(!q) return renderProducts(STATE.products);
    const filtered = STATE.products.filter(p=> (p.name+' '+(p.cat||'')).toLowerCase().includes(q));
    renderProducts(filtered);
  });

  // camera button: show a clear placeholder
  document.getElementById('cameraBtn').addEventListener('click', ()=> {
    // friendly, informative message instead of silent "coming soon"
    alert("Camera search is not available in this web demo yet. Use the text search box to find items. App will support image search in a future release.");
  });

  // theme toggle
  document.getElementById('themeToggle')?.addEventListener('click', ()=> {
    const cur = document.body.getAttribute('data-theme');
    const next = cur==='dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', next);
    localStorage.setItem('damitools_theme', next);
  });

  // menu profile & signout
  document.getElementById('signOutBtn').addEventListener('click', async ()=>{
    if(auth){
      try{ await auth.signOut(); toast('Signed out'); updateProfileUI(null); } catch(e){ console.warn(e); }
    } else { toast('Signed out (local)'); updateProfileUI(null); }
  });

  function toggleMenu(open){
    const el = document.getElementById('menuPanel');
    if(open) el.classList.add('open'); else el.classList.remove('open');
  }

  document.getElementById('menuSupport').addEventListener('click', ()=> {
    alert('Help & Support\nCall: 09036470778\nWhatsApp: 07054700008\nEmail: oluwadamilaremoses14@gmail.com');
  });

  document.getElementById('menuProfile').addEventListener('click', ()=> {
    window.location.href = 'login.html';
  });

  // About modal open
  document.getElementById('menuAbout').addEventListener('click', (e)=> {
    e.preventDefault();
    document.getElementById('aboutModal').classList.add('open');
    document.getElementById('aboutModal').style.display = 'flex';
  });
  document.getElementById('closeAboutBtn').addEventListener('click', ()=>{
    document.getElementById('aboutModal').classList.remove('open');
    document.getElementById('aboutModal').style.display = 'none';
  });

  // open cart from top nav
  document.getElementById('navCart').addEventListener('click',(e)=>{ e.preventDefault(); openCartView(); });

  // categories modal
  document.getElementById('navCategories').addEventListener('click',(e)=>{ e.preventDefault(); toggleCategories(); });

  function toggleCategories(){
    const el = document.getElementById('catModal');
    if(el.classList.contains('open')){
      el.classList.remove('open'); el.setAttribute('aria-hidden','true');
    } else {
      renderCategoryList();
      el.classList.add('open'); el.setAttribute('aria-hidden','false');
    }
  }

  function renderCategoryList(){
    const container = document.getElementById('catList');
    container.innerHTML = '';
    const cats = STATE.categories;
    cats.forEach(cat=>{
      const b = document.createElement('div');
      b.className = 'cat-item';
      b.innerText = cat;
      b.onclick = ()=> {
        document.getElementById('catModal').classList.remove('open');
        document.getElementById('catModal').setAttribute('aria-hidden','true');
        if(cat === 'All') renderProducts();
        else {
          const filtered = STATE.products.filter(p => (p.cat||'').toLowerCase() === cat.toLowerCase());
          renderProducts(filtered);
        }
      };
      container.appendChild(b);
    });
  }

  // back button support (Android-like)
  window.addEventListener('popstate', function(e){
    if(modalBackdrop.classList.contains('open')){ modalBackdrop.classList.remove('open'); history.pushState({},''); }
  });

  // show profile info if user logged in
  function updateProfileUI(user){
    const name = user ? (user.displayName || user.email || 'User') : 'Guest';
    const photo = user && user.photoURL ? user.photoURL : 'https://i.imgur.com/6VBx3io.png';
    document.getElementById('menuAvatarName').innerText = name;
    document.getElementById('menuAvatarEmail').innerText = user ? (user.email || '') : 'Not signed in';
    document.getElementById('menuAvatarImg').src = photo;
  }

  // Firebase auth state
  if(auth){
    auth.onAuthStateChanged(user=>{
      if(user) updateProfileUI(user); else updateProfileUI(null);
    });
  } else updateProfileUI(null);

  // utility escapeHtml
  function escapeHtml(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  /* ============================
     Init app
     ============================ */
  (function init(){
    // apply saved theme
    const savedTheme = localStorage.getItem('damitools_theme'); if(savedTheme) document.body.setAttribute('data-theme', savedTheme);

    renderProducts();
    renderCart();
    // categories ready
    // expose for debugging
    window.STATE = STATE;
    // small keyboard back handling
    document.addEventListener('keydown',(ev)=>{ if(ev.key==='Escape'){ modalBackdrop.classList.remove('open'); toggleMenu(false); document.getElementById('aboutModal').classList.remove('open'); } });
  })();
  </script>
</body>
</html>
